<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小鹰健康服务平台</title>
    <!--标题logo-->
    <link rel="shortcut icon" href="../../img/favicon.png">
    <link rel="stylesheet" href="../../css/base.css">
    <link rel="stylesheet" href="../../css/home.css">
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="../../css/new-document.css">
    <link rel="icon" href="" type="image/x-icon">
    <link rel="shortcut icon" href="" type="image/x-icon">
    <link rel="stylesheet" href="../../js/bootstrap.table/bootstrap-table.min.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="../../js/highcharts.js"></script>
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script src="../../js/index.js"></script>
    <script src="../../js/new-document.js"></script>
    <script src="../../js/bootstrapValidator.js"></script>
    <script src="../../js/bootstrap.table/bootstrap-table.min.js"></script>
    <script src="../../js/bootstrap.table/bootstrap-table-zh-CN.min.js"></script>
    <script src="../../js/date.js"></script>
</head>
<body>
    <!--公用头部-->
    <div class="head">
            <div class="head-con">
                <div class="head-left"><img src="../../img/logo.png"></div>
                <div class="head-dh">
                    <ul>
                        <li class="glyphicon glyphicon-home home ah"><a class="head-dh-a" href="../../index.html" >首页</a></li>
                        <li class="glyphicon glyphicon-heart service btn-group ah">
                            <a class="head-dh-a active" data-toggle="dropdown" style="cursor: pointer;">
                                健康服务
                            </a>
                            <ul class="dropdown-menu service-word">
                                <li>
                                    <h4>档案中心</h4>
                                    <span><a href="../../templates/archives/new-archives.html" class="archives menu-a">个人档案管理</a></span>
                                    <span><a href="../../templates/health/chronic.html" class="menu-a">慢性病人群管理</a></span>
                                </li>
                                <li>
                                    <h4>就诊信息</h4>
                                    <span><a href="" class="menu-a">门诊信息</a></span>
                                    <span><a href="" class="menu-a">住院信息</a></span>
                                </li>
                                <li>
                                    <h4>体检信息</h4>
                                    <span><a href="" class="menu-a">体检信息-管理</a></span>
                                    <span><a href="" class="menu-a">体检信息-新增</a></span>
                                </li>
                                <li>
                                    <h4>随访管理</h4>
                                    <span><a href="" class="menu-a">常规随访</a></span>
                                    <span><a href="" class="menu-a">慢性随访</a></span>
                                    <span><a href="" class="menu-a">满意度调查</a></span>
                                    <span><a href="" class="menu-a">统计分析</a></span>
                                </li>
                                <li>
                                    <h4>行政区域管理</h4>
                                    <span><a href="../../templates/health/area.html#?/apis/baseRegion/regionGrade/1" class="menu-a">行政区</a></span>
                                </li>
                                <li>
                                    <h4>权限管理</h4>
                                    <span><a href="../../templates/admin/role.html" class="menu-a">角色管理</a></span>
                                    <span><a href="../../templates/admin/user.html" class="menu-a">用户管理</a></span>
                                </li>
                            </ul>
                        </li>
                        <li class="glyphicon glyphicon-file jk ah"><a class="head-dh-a" onclick="sessionStorage.removeItem('user')" href="../../templates/document/new-document1.html">新建文档</a></li>
                    </ul>
                    <div class="health">
                        <div class="health-1">
                            <h3>档案中心</h3>
                            <span>个人档案管理</span>
                            <span>慢性病人群管理</span>
                        </div>
                        <div class="health-1">
                            <h3>就诊信息</h3>
                            <span>门诊信息</span>
                            <span>住院信息</span>
                        </div>
                        <div class="health-1">
                            <h3>体检信息</h3>
                            <span>体检信息-管理</span>
                            <span>体检信息-新增</span>
                        </div>
                        <div class="health-1 onbot">
                            <h3>随访管理</h3>
                            <span>常规随访</span>
                            <span>慢性随访</span>
                            <span>满意度调查</span>
                            <span>统计分析</span>
                        </div>
                    </div>
                </div>
                <!--右边用户-->
                <div class="head-right">
                    <div class="head-admin">
                        当前用户:王五
                    </div>
                    <div class="dropdown head-admin2 ">
                        <button type="button" class="btn dropdown-toggle" id="dropdownMenu1"
                                data-toggle="dropdown">
                            用户
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                            <li role="presentation">
                                <a role="menuitem" tabindex="-1" href="#">用户信息</a>
                            </li>
                            <li role="presentation">
                                <a role="menuitem" tabindex="-1" href="#">账号安全</a>
                            </li>
                            <li role="presentation" class="divider"></li>
                            <li role="presentation">
                                <a role="menuitem" tabindex="-1" onclick="sessionStorage.removeItem('user')">录入新病例</a>
                            </li>
                            <li role="presentation">
                                <a role="menuitem" tabindex="-1" onclick="logout()">退出账号</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    <!--公用头部end-->
    <!--内容部分-->
    <div class="content2">
        <div class="new-left">
            <ul>
                <li class="updata on"><a href="new-archives-da1.html">个人信息</a></li>
                <li class="updata"><a href="new-archives-da2.html">基本信息</a></li>
                <li class="updata"><a href="new-archives-da3.html">既往史</a></li>
                <li class="updata "><a href="new-archives-da4.html">过敏史</a></li>
                <li class="updata"><a href="new-archives-da5.html">个人史</a></li>
                <li class="updata yjs"><a href="new-archives-da6.html">月经及婚育史</a></li>
                <li class="updata"><a href="new-archives-da7.html">家族史</a></li>
                <li class="updata Chronic1"><a href="new-archives-da9.html">高血压情况</a></li>
                <li class="updata Chronic2"><a href="new-archives-da10.html">糖尿病情况</a></li>
                <li class="updata Chronic3"><a href="new-archives-da11.html">肺结核情况</a></li>
                <li class="updata Chronic4"><a href="new-archives-da12.html">精神病情况</a></li>
            </ul>
        </div>
        <div class="new-right">
            <ul>
                <li class="on person-info" style="padding: 0 20px;">
                    <dl class="word-1-ck" style="margin-top: 20px;">
                        <dt>
                            <span class="word-1-ck-huan">姓名:</span>
                            <label id="name" class="word-1-ck-huan-1"></label>
                        </dt>
                        <dt class="xingbie">
                            <span class="word-1-ck-huan">性别:</span>
                            <label id="sex" class="word-1-ck-huan-1"></label>
                        </dt>
                    </dl>
                    <dl class="word-1-ck">
                        <dt>
                            <span>
                                <span class="word-1-ck-huan">证件类型:</span>
                                <label id="cardType" class="word-1-ck-huan-1"></label>
                            </span>
                        </dt>
                        <dt>
                            <span>
                                <span class="word-1-ck-huan">证件号:</span>
                                <label id="cardNum" class="word-1-ck-huan-1"></label>
                            </span>
                        </dt>
                    </dl>
                    <dl class="word-1-ck">
                        <dt>
                            <span class="word-1-ck-huan">国籍:</span>
                            <label id="country" class="word-1-ck-huan-1"></label>
                        </dt>
                        <dt>
                            <span class="word-1-ck-huan">民族:</span>
                            <label id="nationName" class="word-1-ck-huan-1"></label>
                        </dt>
                    </dl>
                    <dl class="word-1-ck">
                        <dt>
                            <span class="word-1-ck-huan">出生日期:</span>
                            <label id="birthday" class="word-1-ck-huan-1"></label>
                        </dt>
                        <dt>
                            <span class="word-1-ck-huan">血型:</span>
                            <label id="bloodType" class="word-1-ck-huan-1a"></label>
                            <label id="rh" class="word-1-ck-huan-1a">kn</label>
                        </dt>
                    </dl>
                    <dl class="word-1-ck">
                        <dt>
                            <span class="word-1-ck-huan">建档时间:</span>
                            <label id="fileCreateTime" class="word-1-ck-huan-1"></label>
                        </dt>
                    </dl>
                </li>

            </ul>
        </div>
    </div>


    <!--内容部分end-->
    <!--Foot-->
    <div class="foot">
        <div class="foot-border">Copyright &copy; 2017-2020 Yinghai Software Co., Ltd, Technical Support<br>
            鹰海医疗信息技术有限公司 技术支持</div>
    </div>

<script>
    /*新建文档*/
    var work = new FindSure();
    work.init();

    var id =sessionStorage.getItem("user");
    $(function(){
        loadPersonInfo();
    });
    var blood = {
            b1:"A型",
            b2:"B型",
            b3:"O型",
            b4:"AB型",
            b5 :"不详"
    };

    var card = {
        c1:"身份证",
        c2:"护照",
        c3:"警官证"
    };
    /**
     * 加载个人信息
     */
    function loadPersonInfo(){
        $.ajax({
            async:false,
            url:"/apis/file/"+id,
            success:function(data){
                if (data.returnFlag != 0) {
                    alert( data.message);
                }else{
                    console.log(data);
                    var row = data.data;
                    $(".person-info label").each(function(){
                        var key = this.id;
                        if(row[key] == null || row[key] == undefined){
                            this.innerHTML = "(空)";
                        } else{
                            if(key=="sex"){
                                if(row["sex"]) this.innerHTML = "男";
                                else {
                                    this.innerHTML = "女";
                                    $(".yjs").show();
                                }

                            }else if(key.indexOf("Time") >0 || key == "birthday"){
                                this.innerHTML = getPreMonth(new Date( row[key]),0);
                            }else if(key =="bloodType"){
                                if(row[key] == -1)    key = "5";
                                this.innerHTML = blood["b"+row[key]];
                            } else if(key == "country"){
                                if(row[key] == 1)  this.innerHTML ="中国";
                                else this.innerHTML ="其他";
                            }
//                            else if(key== "connectType"){
//                                if( row[key] == 1)  this.innerHTML = "手机号码";
//                                else if( row[key] == 2)  this.innerHTML = "固定电话";
//                                else this.innerHTML = "";
//                            }
                            else if(key == "cardType"){
                                this.innerHTML = card["c"+row[key]];
                            }else if(key == "rh"){
                                if(row[key])  this.innerHTML = "(RH阴)";
                            } else this.innerHTML = row[key];
                        }
                    })
                }
            }
        })
    }
    /**
     * 既往史
     */
    function loadPersonHistoryIless(){
        $('#tableHis').bootstrapTable('destroy'); //先销毁表格
        $('#tableHis').bootstrapTable({
            url: "/apis/fileHistoryPastIllnessInfo/"+id,
            onLoadSuccess: function (data) {
                if (data.returnFlag != 0) {
                    alert( data.message);
                } else {
                    mergeCell(data.data);
                }
                console.log(data);
//                if((data.data).length == 0){
//                    $("#history-iless").html('<dd class="mode-head-1"><h5>（无）</h5></dd>');
//              }
            },
            onLoadError: function () {
                alert(" 服务器无响应！");
            }
        })
    };

    /**
     * 合并元各
     * @param rows
     */
    function mergeCell(rows){
        var index = 0;
        var rowspan = 1;
        for(var i = 0;i<rows.length;i++){
            if(i == rows.length - 1)
                $("#tableHis").bootstrapTable('mergeCells', {index: index, field: 'requestName', colspan: 1, rowspan: rowspan});
            else{
                if(rows[i].requestId == rows[i+1].requestId) rowspan++;
                else {
                    $("#tableHis").bootstrapTable('mergeCells', {index: index, field: 'requestName', colspan: 1, rowspan: rowspan});
                    index = i+1;
                    rowspan = 1;
                }
            }
        }
        $("#tableHis").bootstrapTable('mergeCells', {index:0, field: 'answerId', colspan:1, rowspan:rows.length});
    };
    function timeFormatter(value,row,index){
        return "确诊时间";
    }
    
    function cellStyle(value,row,index){
        return  {  css: {"color": "#000","font-weight":" bold"} };
    }
</script>
</body>
</html>